<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Game Ular — Virtual Joystick</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#10b981;
      --muted:#94a3b8;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, Arial;
      background:linear-gradient(180deg,#071022 0%, #071b2a 100%);
      color:#e6eef8;
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .wrap{
      width:100%;
      max-width:920px;
      display:flex;
      flex-direction:column;
      gap:20px;
      align-items:center;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-shadow:0 6px 24px rgba(2,6,23,0.6);
      display:flex;
      flex-direction:column;
      gap:12px;
      width:100%;
    }

    .info-card{
      display:flex;
      gap:12px;
      padding:12px;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow:0 4px 18px rgba(0,0,0,0.4);
      align-items:center;
      width:100%;
    }
    .info-card img{
      width:70px;
      height:70px;
      border-radius:10px;
      object-fit:cover;
    }
    .info-text{
      font-size:14px;
      color:#cdd6e3;
    }
    .credit{
      margin-top:6px;
      opacity:0.7;
      font-size:13px;
    }

    canvas{
      background:linear-gradient(180deg,#021529, #052a3b);
      border-radius:8px;
      width:100%;
      height:auto;
      display:block;
      image-rendering:pixelated;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.5);
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      background:var(--panel);
      color:var(--accent);
      border:1px solid rgba(255,255,255,0.03);
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      user-select:none;
      font-weight:600;
    }
    .btn.primary{
      background:linear-gradient(90deg, #064e3b, #046c56);
      color:white;
      border:none;
    }
    .status{
      margin-left:auto;
      color:var(--muted);
      font-size:14px;
    }

    .joystick{
      background:linear-gradient(180deg,#061425,#04202b);
      padding:14px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      width:100%;
    }

    .joystick-grid{
      display:grid;
      grid-template-columns: 60px 60px 60px;
      grid-template-rows: 60px 60px 60px;
      gap:8px;
      align-items:center;
      justify-items:center;
    }

    .dir-btn{
      width:60px;
      height:60px;
      border-radius:10px;
      background:rgba(255,255,255,0.02);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.02);
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }
    .dir-btn:active{
      transform:scale(0.97);
      background:rgba(255,255,255,0.03);
    }

    .small{
      font-size:13px;
      color:var(--muted);
    }

    .footer{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
    }

    .range{
      width:150px;
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- INFO CARD DIPINDAH KE PALING ATAS -->
    <div class="info-card">
      <img src="foto.jpg" alt="Foto">
      <div class="info-text">
        Game Ular — Virtual Joystick<br>
        <div class="credit">by: <b>kakaalifacms-ai</b></div>
      </div>
    </div>

    <!-- CARD GAME -->
    <div class="card">
      <h2 style="margin:0">Ular Jalan — Kontrol Virtual</h2>
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div class="controls">
          <button id="startBtn" class="btn primary">Jalan</button>
          <button id="resetBtn" class="btn">Reset</button>
          <div style="display:flex;align-items:center;gap:8px;margin-left:8px">
            <label class="small" for="speed">Kecepatan</label>
            <input id="speed" class="range" type="range" min="4" max="18" value="10">
          </div>
        </div>
        <div class="status" id="status">Status: berhenti</div>
      </div>

      <canvas id="game" width="480" height="480"></canvas>

      <div class="footer">
        <div class="small">Papan pixel: <span id="gridSize">24</span> × <span id="gridSizeY">24</span></div>
        <div class="small">Skor: <strong id="score">0</strong></div>
      </div>
    </div>

    <!-- JOYSTICK (TETAP DI BAWAH GAME) -->
    <div class="joystick card" style="padding:12px">
      <div style="font-weight:700">Virtual Joystick</div>

      <div class="joystick-grid" aria-hidden="true">
        <div></div>
        <div><button class="dir-btn" data-dir="up" id="btnUp">▲</button></div>
        <div></div>

        <div><button class="dir-btn" data-dir="left" id="btnLeft">◀</button></div>
        <div style="width:60px;height:60px;border-radius:999px;background:linear-gradient(90deg,#012a2b,#003a34);display:flex;align-items:center;justify-content:center;font-weight:700;color:white">GL</div>
        <div><button class="dir-btn" data-dir="right" id="btnRight">▶</button></div>

        <div></div>
        <div><button class="dir-btn" data-dir="down" id="btnDown">▼</button></div>
        <div></div>
      </div>

      <div class="small" style="margin-top:8px">
        Gunakan tombol arah <b>di bawah</b> untuk mengubah arah ular.
      </div>
    </div>

    <!-- KONTROL KEYBOARD (TETAP) -->
    <div class="card" style="padding:12px">
      <div style="font-weight:700;margin-bottom:6px">Kontrol keyboard</div>
      <div class="small">Panah ↑ ↓ ← → / W A S D</div>
    </div>

  </div>

<script>
  /* SCRIPT ORIGINAL — TIDAK DIUBAH SEDIKITPUN */
  (()=>{
    const canvas=document.getElementById('game');
    const ctx=canvas.getContext('2d',{alpha:false});
    let grid=24;
    const tileCountX=grid;
    const tileCountY=grid;
    document.getElementById('gridSize').textContent=tileCountX;
    document.getElementById('gridSizeY').textContent=tileCountY;

    const width=canvas.width;
    const height=canvas.height;
    const tileW=Math.floor(width/tileCountX);
    const tileH=Math.floor(height/tileCountY);

    let snake=[{x:Math.floor(tileCountX/2),y:Math.floor(tileCountY/2)}];
    let dir={x:0,y:0};
    let nextDir={x:0,y:0};
    let food=null;
    let running=false;
    let score=0;
    let speed=parseInt(document.getElementById('speed').value,10);
    let tickInterval=null;

    function placeFood(){
      while(true){
        const f={x:Math.floor(Math.random()*tileCountX),y:Math.floor(Math.random()*tileCountY)};
        if(!snake.some(s=>s.x===f.x&&s.y===f.y)){food=f;break;}
      }
    }

    function resetGame(){
      snake=[{x:Math.floor(tileCountX/2),y:Math.floor(tileCountY/2)}];
      dir={x:0,y:0};
      nextDir={x:0,y:0};
      score=0;
      document.getElementById('score').textContent=score;
      placeFood();
      draw();
      stopLoop();
      running=false;
      updateStatus();
      document.getElementById('startBtn').textContent='Jalan';
    }

    function updateStatus(){
      document.getElementById('status').textContent=
        running?'Status: berjalan':'Status: berhenti';
    }

    function startLoop(){
      stopLoop();
      const fps=speed;
      const ms=Math.max(8,Math.round(1000/fps));
      tickInterval=setInterval(tick,ms);
    }
    function stopLoop(){
      if(tickInterval){clearInterval(tickInterval);tickInterval=null;}
    }

    function tick(){
      if(!(nextDir.x===-dir.x&&nextDir.y===-dir.y)){
        dir={...nextDir};
      }
      if(dir.x===0&&dir.y===0){draw();return;}

      const head={
        x:(snake[0].x+dir.x+tileCountX)%tileCountX,
        y:(snake[0].y+dir.y+tileCountY)%tileCountY
      };

      if(snake.some(s=>s.x===head.x&&s.y===head.y)){
        running=false;
        updateStatus();
        document.getElementById('startBtn').textContent='Jalan';
        stopLoop();
        drawCrash();
        setTimeout(resetGame,800);
        return;
      }

      snake.unshift(head);

      if(food&&head.x===food.x&&head.y===food.y){
        score++;
        document.getElementById('score').textContent=score;
        placeFood();
      }else snake.pop();

      draw();
    }

    function draw(){
      ctx.fillStyle='#031826';
      ctx.fillRect(0,0,width,height);

      if(food){
        roundRect(food.x*tileW+2,food.y*tileH+2,tileW-4,tileH-4,6,'#f59e0b');
        ctx.fillStyle='rgba(255,255,255,0.16)';
        ctx.fillRect(food.x*tileW+tileW*0.18,food.y*tileH+tileH*0.12,tileW*0.25,tileH*0.18);
      }

      for(let i=0;i<snake.length;i++){
        const s=snake[i];
        const x=s.x*tileW,y=s.y*tileH;

        if(i===0){
          roundRect(x+2,y+2,tileW-4,tileH-4,8,'#10b981');
          ctx.fillStyle='#052018';
          const ex=x+(dir.x===1?tileW*0.65:dir.x===-1?tileW*0.2:tileW*0.45);
          const ey=y+(dir.y===1?tileH*0.65:dir.y===-1?tileH*0.2:tileH*0.45);
          ctx.fillRect(ex,ey,tileW*0.08,tileH*0.08);
        }else{
          const t=0.3+0.7*(1-i/snake.length);
          const g=Math.round(16+(160-16)*t);
          roundRect(x+3,y+3,tileW-6,tileH-6,6,`rgb(16,${g},129)`);
        }
      }
    }

    function roundRect(x,y,w,h,r,fill){
      ctx.fillStyle=fill;
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r);
      ctx.fill();
    }

    function drawCrash(){
      const prev=ctx.getImageData(0,0,width,height);
      ctx.fillStyle='rgba(239,68,68,0.25)';
      ctx.fillRect(0,0,width,height);
      setTimeout(()=>ctx.putImageData(prev,0,0),150);
    }

    document.getElementById('startBtn').onclick=()=>{
      running=!running;
      if(running){
        if(dir.x===0&&dir.y===0&&nextDir.x===0&&nextDir.y===0){
          nextDir={x:1,y:0};
        }
        document.getElementById('startBtn').textContent='Stop';
        startLoop();
      }else{
        document.getElementById('startBtn').textContent='Jalan';
        stopLoop();
      }
      updateStatus();
    };

    document.getElementById('resetBtn').onclick=resetGame;

    document.getElementById('speed').oninput=e=>{
      speed=parseInt(e.target.value,10);
      if(running)startLoop();
    };

    const keys={
      ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},
      ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},
      w:{x:0,y:-1},s:{x:0,y:1},
      a:{x:-1,y:0},d:{x:1,y:0},
    };
    window.onkeydown=e=>{
      if(keys[e.key]){
        e.preventDefault();
        const nd=keys[e.key];
        if(!(nd.x===-dir.x&&nd.y===-dir.y))nextDir={...nd};
      }else if(e.key===' ')document.getElementById('startBtn').click();
    };

    function bindDir(id,dx,dy){
      const b=document.getElementById(id);
      const set=ev=>{
        ev.preventDefault();
        if(!(dx===-dir.x&&dy===-dir.y))nextDir={x:dx,y:dy};
      };
      b.addEventListener('touchstart',set,{passive:false});
      b.addEventListener('mousedown',set);
    }
    bindDir('btnUp',0,-1);
    bindDir('btnDown',0,1);
    bindDir('btnLeft',-1,0);
    bindDir('btnRight',1,0);

    canvas.ondblclick=()=>document.getElementById('startBtn').click();

    function fit(){
      const w=canvas.parentElement.clientWidth;
      const d=Math.min(w-12,640);
      canvas.style.width=d+'px';
      canvas.style.height=d+'px';
    }
    window.onresize=fit;
    fit();

    placeFood();
    draw();
    updateStatus();
  })();
</script>

</body>
</html>